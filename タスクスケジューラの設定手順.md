# タスクスケジューラで printviewer 監視を設定する手順

「何も起きない」場合は、次の手順を**そのまま**試してください。

---

## 1. タスクスケジューラを開く

- **Win + R** を押す → `taskschd.msc` と入力 → **Enter**
- または「タスク スケジューラ」で検索して起動

---

## 2. 新しいタスクを作る（「基本タスク」は使わない）

- 右側の **「タスクの作成」** をクリック  
  （「基本タスクの作成」ではなく「タスクの作成」）

---

## 3. 「全般」タブ

- **名前**: `printviewer監視` など好きな名前
- **セキュリティオプション**:
  - 「**ユーザーがログオンしているときのみ実行する**」を選ぶ  
    （「最上位の特権で実行」にチェックを入れてもよい）
- 「ユーザーがログオンしているかどうかに関わらず実行する」を選ぶと、ログオン前でも動くが、設定がややこしくなるので、まずは「ログオンしているときのみ」で試す

---

## 4. 「トリガー」タブ

- **「新規」** をクリック
- **タスクの開始**: 「**スケジュールに従う**」
- **設定**:
  - 「**1回**」のまま
  - 開始: **今日の日付**
  - 時刻: **0:00**（深夜でよい）
- **詳細設定**:
  - 「**間隔を指定して繰り返す**」にチェック
  - 間隔: **1分**
  - 期間: **無期限**
  - 「**有効**」にチェック
- **OK**

もう1つトリガーを追加（ログオン時にも動かす場合）:

- **「新規」** をクリック
- **タスクの開始**: 「**ログオン時**」
- ユーザー: 自分のユーザー
- **OK**

---

## 5. 「操作」タブ（ここが重要）

- **「新規」** をクリック
- **操作**: 「**プログラムの開始**」のまま
- **プログラム/スクリプト** に **フルパス** を入力:
  ```
  C:\Users\doctor\printviewer\watch_printviewer.bat
  ```
  （環境に合わせて printviewer のパスを変える）
- **「開始」（オプションの引数を追加する）** に、**必ず** 次のように入力:
  ```
  C:\Users\doctor\printviewer
  ```
  （watch_printviewer.bat があるフォルダと同じパス）
- **OK**

※「開始」を空にすると、タスク実行時にカレントフォルダが違って Python や venv が見つからず、何も起きないことがあります。

---

## 6. 「条件」「設定」タブ

- **条件**タブ: 「コンピューターを AC 電源で使用している場合のみ～」のチェックは**外して**おく（ノートPCでも動くように）
- **設定**タブ: そのままでよい

---

## 7. 保存してテスト

- **OK** でタスクを保存
- 一覧で「printviewer監視」を**右クリック** → **「実行」**
- 窓は出ません。次のどちらかで動いているか確認:

### 確認1: ログを見る

- エクスプローラーで `C:\Users\doctor\printviewer` を開く
- **watch_printviewer.log** を開く（メモ帳でよい）
- 中に `[日付 時刻] Starting printviewer...` や `printviewer already running.` のような行が**追記されていれば**タスクは動いています

### 確認2: アプリを開く

- ブラウザで **http://127.0.0.1:5000** を開く
- printviewer の画面が出れば、起動は成功しています

---

## それでも何も起きないとき

1. **watch_printviewer.log ができない**
   - タスクが実行されていない可能性
   - 「操作」の**プログラム/スクリプト**が `watch_printviewer.bat` の**フルパス**になっているか確認
   - 「開始」が printviewer フォルダの**フルパス**になっているか確認

2. **ログに「Python not found」と出る**
   - 「開始」が正しく printviewer フォルダになっているか確認
   - 手動で `watch_printviewer_test.bat` をダブルクリックすると動く場合 → タスクの「開始」が空か別のフォルダになっていることが多いです

3. **ログは増えるがアプリが起動しない**
   - **start_printviewer.log** を開く
   - 「ERROR」や「Python not found」が出ていないか確認
   - Anaconda を使っている場合、`%USERPROFILE%\anaconda3\python.exe` が存在するか確認

---

## まとめ（コピペ用）

| 項目 | 入力する値 |
|------|------------|
| プログラム/スクリプト | `C:\Users\doctor\printviewer\watch_printviewer.bat` |
| 開始 | `C:\Users\doctor\printviewer` |

この2つが正しく入っていれば、タスクは動くはずです。
